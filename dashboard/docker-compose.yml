services:
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    restart: unless-stopped
    depends_on:
      - dockerproxy
    environment:
      - HOMEPAGE_ALLOWED_HOSTS=home.${DOMAIN}
      - HOMEPAGE_VAR_DOMAIN=${DOMAIN}
      - HOMEPAGE_VAR_NAVIDROME_USER=${NAVIDROME_USER}
      - HOMEPAGE_VAR_NAVIDROME_TOKEN=${NAVIDROME_TOKEN}
      - HOMEPAGE_VAR_NAVIDROME_SALT=${NAVIDROME_SALT}
      - HOMEPAGE_VAR_TRUENAS_URL=http://${TRUENAS_IP}
      - HOMEPAGE_VAR_TRUENAS_KEY=${TRUENAS_KEY}
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3000"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 15s
    volumes:
      - ./config:/app/config
      - /:/host:ro
    networks:
      - proxy_net

  dockerproxy:
    image: tecnativa/docker-socket-proxy
    container_name: dockerproxy
    restart: unless-stopped
    environment:
      - CONTAINERS=1
      - IMAGES=1
      - NETWORKS=1
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - proxy_net

networks:
  proxy_net:
    external: true
